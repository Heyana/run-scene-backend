# 需求管理平台 - 快速启动

## 后端已完成

### ✅ 已实现的模块

1. **配置系统**
   - `configs/requirement.yaml` - 功能配置
   - `config/requirement_config.go` - 配置加载

2. **数据模型** (`models/requirement/`)
   - `company.go` - 公司和成员
   - `project.go` - 项目和成员
   - `mission_list.go` - 任务列表
   - `mission.go` - 任务及相关

3. **业务逻辑** (`services/requirement_service/`)
   - `company_service.go`
   - `project_service.go`
   - `mission_list_service.go`
   - `mission_service.go`

4. **API控制器** (`controllers/requirement/`)
   - `company_controller.go`
   - `project_controller.go`
   - `mission_list_controller.go`
   - `mission_controller.go`

5. **路由注册**
   - `api/requirement_routes.go`
   - 已在 `api/routes.go` 中添加注释提示

6. **数据库初始化**
   - `database/init_requirement.go`
   - 已集成到 `database/database.go`

7. **配置加载**
   - 已集成到 `core/app_core.go`

## 启动步骤

### 1. 手动添加路由调用

在 `api/routes.go` 的 `RegisterRoutes` 函数末尾添加：

```go
// ==================== 需求管理平台路由 ====================
SetupRequirementRoutes(router)
```

### 2. 编译运行

```bash
cd run-scene-backend
go build -tags dev -o app_test.exe
./app_test.exe
```

### 3. 验证功能

访问以下API测试：

```bash
# 健康检查
curl http://localhost:23359/api/ping

# 登录获取token
curl -X POST http://localhost:23359/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123456"}'

# 创建公司（需要token）
curl -X POST http://localhost:23359/api/requirement/companies \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"name":"测试公司","description":"这是一个测试公司"}'

# 获取公司列表
curl http://localhost:23359/api/requirement/companies \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## API端点

### 公司管理

- `GET /api/requirement/companies` - 获取公司列表
- `POST /api/requirement/companies` - 创建公司
- `GET /api/requirement/companies/:id` - 获取公司详情
- `PUT /api/requirement/companies/:id` - 更新公司
- `POST /api/requirement/companies/:id/members` - 添加成员
- `DELETE /api/requirement/companies/:id/members/:user_id` - 移除成员
- `GET /api/requirement/companies/:id/members` - 获取成员列表

### 项目管理

- `GET /api/requirement/projects` - 获取项目列表
- `POST /api/requirement/projects` - 创建项目
- `GET /api/requirement/projects/:id` - 获取项目详情
- `PUT /api/requirement/projects/:id` - 更新项目
- `POST /api/requirement/projects/:id/members` - 添加成员
- `DELETE /api/requirement/projects/:id/members/:user_id` - 移除成员
- `GET /api/requirement/projects/:id/members` - 获取成员列表
- `GET /api/requirement/projects/:id/statistics` - 获取统计

### 任务列表管理

- `GET /api/requirement/mission-lists` - 获取任务列表
- `POST /api/requirement/mission-lists` - 创建任务列表
- `GET /api/requirement/mission-lists/:id` - 获取详情
- `PUT /api/requirement/mission-lists/:id` - 更新任务列表
- `DELETE /api/requirement/mission-lists/:id` - 删除任务列表

### 任务管理

- `GET /api/requirement/missions` - 获取任务列表
- `POST /api/requirement/missions` - 创建任务
- `GET /api/requirement/missions/:id` - 获取任务详情
- `PUT /api/requirement/missions/:id` - 更新任务
- `DELETE /api/requirement/missions/:id` - 删除任务
- `PATCH /api/requirement/missions/:id/status` - 更新状态
- `POST /api/requirement/missions/:id/comments` - 添加评论

## 权限说明

系统会自动创建以下权限和权限组：

### 权限

- `requirement:company:*` - 公司管理权限
- `requirement:project:*` - 项目管理权限
- `requirement:mission:*` - 任务管理权限

### 权限组

- `requirement_admin` - 需求管理管理员
- `requirement_member` - 需求管理成员
- `requirement_viewer` - 需求管理观察者

## 配置说明

编辑 `configs/requirement.yaml` 可以修改：

- 功能开关
- 任务默认值
- 文件上传限制
- 权限角色
- 性能参数

## 下一步

1. ✅ 后端API已完成
2. ⏳ 前端开发（待实施）
3. ⏳ 附件上传功能
4. ⏳ 实时通知
5. ⏳ 统计报表优化

## 故障排查

### 数据库初始化失败

- 检查 `data/app.db` 文件权限
- 查看日志文件 `logs/app.log`

### 路由404

- 确认已在 `api/routes.go` 中调用 `SetupRequirementRoutes(router)`
- 检查配置文件 `configs/requirement.yaml` 中 `enabled: true`

### 权限不足

- 确认用户已登录并获取token
- 检查用户是否有相应权限
- 查看 `permission_groups` 表确认权限组配置

## 测试数据

系统启动后会自动创建：

- 默认管理员账号：`admin` / `admin123456`
- 需求管理相关权限
- 需求管理权限组

可以使用管理员账号登录后：

1. 创建公司
2. 邀请成员
3. 创建项目
4. 创建任务列表
5. 创建任务
