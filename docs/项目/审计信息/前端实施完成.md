# 审计系统前端实施完成

## 实施时间

2026-02-12

## 前端实施内容

### 1. API 接口封装

**文件**: `frontend/src/api/audit.ts`

封装的接口：

- `getAuditLogs()` - 查询审计日志列表
- `getAuditLog()` - 获取单条审计日志
- `getUserLogs()` - 获取用户的审计日志
- `getResourceLogs()` - 获取资源的审计日志
- `getAuditStatistics()` - 获取统计信息
- `triggerArchive()` - 手动触发归档
- `getArchiveStatistics()` - 获取归档统计信息
- `listArchiveFiles()` - 列出归档文件

### 2. 审计日志页面

**文件**: `frontend/src/views/AuditLogs.tsx`

功能特性：

- 统计卡片展示（总日志数、数据库日志、归档文件、保留天数）
- 多维度搜索过滤（用户名、IP、操作类型、资源类型、状态码、时间范围）
- 审计日志列表展示（分页、排序）
- 日志详情查看（弹窗展示完整信息）
- 手动触发归档功能
- 响应式布局

### 3. 样式文件

**文件**: `frontend/src/views/AuditLogs.less`

样式特性：

- 卡片圆角和阴影
- 统计数据样式
- 表格标签样式
- 代码块样式

### 4. 路由配置

**文件**: `frontend/src/router/index.ts`

添加路由：

```typescript
{
  path: "/audit-logs",
  name: "AuditLogs",
  component: () => import("@/views/AuditLogs.tsx"),
}
```

### 5. 导航菜单

**文件**: `frontend/src/components/Layout.tsx`

添加菜单项：

- 图标：`AuditOutlined`
- 标题：审计日志
- 路径：`/audit-logs`

### 6. 首页快速访问

**文件**: `frontend/src/views/Home.tsx`

添加快速访问卡片：

- 标题：审计日志
- 描述：系统操作审计记录
- 颜色：`#faad14`（橙色）

## 页面功能说明

### 统计卡片

显示4个关键指标：

1. 总日志数 - 统计时间范围内的总日志数
2. 数据库日志 - 当前数据库中的日志数
3. 归档文件 - 已归档的文件数量
4. 保留天数 - 数据库保留策略（默认7天）

### 搜索过滤

支持以下过滤条件：

- 用户名 - 模糊搜索
- IP地址 - 精确匹配
- 操作类型 - 下拉选择（login, logout, create, update, delete, view, download, upload, move, rename）
- 资源类型 - 下拉选择（document, folder, user, project, model, texture）
- 状态码 - 下拉选择（2xx, 3xx, 4xx, 5xx）
- 时间范围 - 日期时间范围选择器

### 日志列表

表格列：

- 时间 - 格式化显示（YYYY-MM-DD HH:mm:ss）
- 用户 - 用户名
- IP地址 - 客户端IP
- 操作 - 带颜色标签（create=绿色, update=蓝色, delete=红色等）
- 资源 - 资源类型
- 方法 - HTTP方法（GET=蓝色, POST=绿色, PUT=橙色, DELETE=红色）
- 路径 - 请求路径（支持省略号）
- 状态码 - 带颜色标签（2xx=成功, 3xx=处理中, 4xx=警告, 5xx=错误）
- 耗时 - 毫秒数（<100ms=成功, <500ms=处理中, <1000ms=警告, >=1000ms=错误）
- 操作 - 详情按钮

### 详情弹窗

显示完整的审计日志信息：

- 基本信息：ID、用户、用户ID、IP地址
- 操作信息：操作类型、资源类型、资源ID、HTTP方法
- 请求信息：请求路径、状态码、耗时、创建时间
- 详细信息：User-Agent、请求体、错误信息（如果有）

### 手动归档

- 按钮：仅在归档功能启用时显示
- 功能：立即触发归档任务
- 反馈：显示归档的日志数量

## 使用示例

### 查询最近7天的日志

1. 访问 `/audit-logs` 页面
2. 默认显示最近7天的日志
3. 可以调整时间范围

### 查询特定用户的操作

1. 在"用户名"输入框输入用户名
2. 点击"搜索"按钮
3. 查看该用户的所有操作记录

### 查询失败的请求

1. 在"状态码"下拉框选择"客户端错误 (4xx)"或"服务器错误 (5xx)"
2. 点击"搜索"按钮
3. 查看所有失败的请求

### 查看日志详情

1. 在日志列表中点击"详情"按钮
2. 弹窗显示完整的日志信息
3. 包括请求体、错误信息等详细内容

## 技术栈

- Vue 3 + TypeScript + TSX
- Ant Design Vue
- Vue Router
- Day.js（时间处理）
- Axios（HTTP请求）

## 响应式设计

- 支持桌面端（>=1200px）
- 支持平板端（768px-1199px）
- 支持移动端（<768px）
- 使用 Ant Design 的 Grid 系统

## 性能优化

- 分页加载，避免一次性加载大量数据
- 懒加载路由组件
- 防抖搜索（可选）
- 虚拟滚动（可选，用于大数据量）

## 后续优化建议

1. 添加实时刷新功能（WebSocket）
2. 添加导出功能（CSV、Excel）
3. 添加图表统计（操作趋势、用户活跃度）
4. 添加告警功能（异常操作提醒）
5. 添加日志对比功能
6. 添加批量操作功能
