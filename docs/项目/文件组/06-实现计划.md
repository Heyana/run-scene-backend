# 文件组功能 - 实现计划

## 实施阶段

### 阶段 1：数据层（30分钟）

**文件**：`models/document_group.go`

**内容**：

- DocumentGroup 结构（支持 ParentID、Level、Path）
- DocumentGroupItem 结构
- 索引定义
- 关联关系

**数据库迁移**：

```go
db.AutoMigrate(&models.DocumentGroup{}, &models.DocumentGroupItem{})
```

### 阶段 2：Service 层（1.5小时）

**文件**：

- `services/document_group/group_service.go`
- `services/document_group/download_service.go`
- `services/document_group/tree_service.go`

**功能**：

- 文件组 CRUD（支持嵌套）
- 移动组、循环检测
- 统计更新（递归向上）
- 树形结构构建
- ZIP 打包（保持目录结构）

### 阶段 3：Controller 层（40分钟）

**文件**：`controllers/document_group_controller.go`

**接口**：12 个 API（包含 tree、move）

**路由注册**：`api/routes.go`

### 阶段 4：前端页面（2小时）

**文件**：

- `frontend/src/api/documentGroups.ts`
- `frontend/src/views/DocumentGroups.tsx`（树形+卡片）
- `frontend/src/views/DocumentGroupDetail.tsx`
- `frontend/src/components/GroupTree.tsx`

**功能**：

- 树形导航（左侧）
- 卡片展示（右侧）
- 拖拽移动组
- 批量下载（支持子组）
- 级联删除

### 阶段 5：测试优化（40分钟）

**测试项**：

- 创建子组、移动组
- 循环引用检测
- 批量下载（包含子组）
- 级联删除
- 统计递归更新

## 预计时间

总计：5 小时

## 注意事项

1. **Path 字段** - 格式：`/1/3/5`，便于查询子孙组
2. **循环检测** - 移动组时必须检测
3. **统计递归** - 向上递归更新所有父组
4. **目录结构** - 下载时保持层级
5. **级联删除** - 提供选项，默认不级联
