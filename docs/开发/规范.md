# 核心开发规范

> 详细指南参考：[API 详细指南](./api-guide.md) | [Swagger 指南](./swagger-guide.md) | [TypeScript 生成指南](./typescript-guide.md)

## 1. API 响应规范

### 统一响应结构

所有 API 必须使用 `response` 包返回统一格式。

**核心原则**：

- 避免使用 `interface{}` 作为参数类型
- 为所有请求/响应定义具体 struct
- Swagger 注释必须指定具体类型

### 常用响应函数

| 场景     | 函数                                                         | HTTP 状态码 |
| -------- | ------------------------------------------------------------ | ----------- |
| 成功     | `response.Success(c, data)`                                  | 200         |
| 分页     | `response.SuccessWithPagination(c, list, total, page, size)` | 200         |
| 参数错误 | `response.BadRequest(c, msg)`                                | 400         |
| 未找到   | `response.NotFound(c, msg)`                                  | 404         |
| 服务错误 | `response.InternalServerError(c, msg)`                       | 500         |

## 2. Swagger 文档规范

### 核心要求

- Swagger 注释必须写在**独立函数**上方
- 使用完整包路径：`response.Response`
- 指定具体类型，避免 `interface{}`

### 标准注释模板

```go
// FunctionName 函数说明
// @Summary 简短摘要
// @Tags 分类名
// @Accept json
// @Produce json
// @Param id path int true "参数说明（示例: 1）"
// @Success 200 {object} response.Response{data=SpecificStruct}
// @Failure 400 {object} response.Response
// @Router /api/path [method]
func FunctionName(c *gin.Context) {}
```

### 生成命令

```bash
swag init -g docs/swagger.go
```

## 3. 控制器规范

### 结构定义

```go
type ModuleController struct {
    logger *logrus.Logger
}

func NewModuleController(logger *logrus.Logger) *ModuleController {
    return &ModuleController{logger: logger}
}
```

### 方法要求

- 每个公开方法必须有 Swagger 注释
- 使用 `response` 包统一返回
- 错误优先处理

## 4. 路由规范

### 路由注册

在 `api/routes.go` 中按模块分组：

```go
module := api.Group("/module")
{
    module.GET("/list", controller.GetList)
    module.POST("/create", controller.Create)
}
```

### RESTful 约定

| 操作 | 方法   | 路径             |
| ---- | ------ | ---------------- |
| 列表 | GET    | `/api/items`     |
| 详情 | GET    | `/api/items/:id` |
| 创建 | POST   | `/api/items`     |
| 更新 | PUT    | `/api/items/:id` |
| 删除 | DELETE | `/api/items/:id` |

## 5. 错误处理规范

```go
// 错误返回
if err != nil {
    response.InternalServerError(c, "操作失败: "+err.Error())
    return
}

// 参数校验
if err := c.ShouldBindJSON(&req); err != nil {
    response.BadRequest(c, "参数错误: "+err.Error())
    return
}
```

## 6. 日志规范

使用注入的 logger：

```go
c.logger.Infof("操作: %s", data)
c.logger.Errorf("错误: %v", err)
```

## 7. TypeScript 类型生成

### 推荐工具：OpenAPI Generator

生成命令：

```bash
openapi-generator-cli generate \
  -i docs/swagger.json \
  -g typescript-axios \
  -o frontend/src/api \
  --additional-properties="supportsES6=true"
```

> 详细配置参考：[TypeScript 生成指南](./typescript-guide.md)

## 8. 类型定义最佳实践

### 结构体定义

```go
type CreateUserRequest struct {
    Username string `json:"username" binding:"required"`
    Email    string `json:"email" binding:"required,email"`
}

type UserResponse struct {
    ID       uint   `json:"id"`
    Username string `json:"username"`
    Email    string `json:"email"`
}
```

### 避免的反模式

- 避免使用 `interface{}`
- 避免使用 `map[string]interface{}`
- 前端需要明确的类型定义

## 9. 开发检查清单

新建 API 时必须确认：

- [ ] 控制器方法有完整 Swagger 注释
- [ ] `@Success` 使用具体类型：`response.Response{data=SpecificType}`
- [ ] 路由已在 `routes.go` 注册
- [ ] 使用 `response` 包返回数据
- [ ] 定义了具体的请求/响应结构体
- [ ] 避免使用 `interface{}`
- [ ] 运行 `swag init` 生成文档
- [ ] 参数描述包含示例值
