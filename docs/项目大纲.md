# 企业名片后台管理系统 - 项目大纲

## 项目概述
企业级后台管理系统，支持Wails桌面应用和Air热重载开发，提供完整的企业管理、微信管理、邀请码配置等功能。

## 技术架构

### 后端技术栈
- **语言**: Go 1.21+
- **Web框架**: Gin
- **数据库**: SQLite + GORM
- **认证**: JWT + bcrypt
- **启动方式**: Wails / Air

### 前端技术栈
- **框架**: React/Vue.js (待实现)
- **UI组件**: Ant Design/Element UI (待实现)
- **构建工具**: Vite/Webpack (待实现)

## 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   API接口层     │    │   数据库层      │
│  (待实现)      │◄──►│   Gin Router    │◄──►│   SQLite       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   业务逻辑层     │
                       │   Controllers   │
                       └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   数据访问层     │
                       │   Models        │
                       └─────────────────┘
```

## 核心模块

### 1. 用户认证模块
- **功能**: 登录、登出、密码修改、会话管理
- **文件**: `api/auth_controller.go`
- **路由**: `/api/auth/*`

### 2. 企业管理模块
- **功能**: 企业CRUD、搜索筛选、分页
- **文件**: `api/enterprise_controller.go`
- **路由**: `/api/enterprises/*`

### 3. 微信管理模块
- **功能**: 微信账号CRUD、昵称管理
- **文件**: `api/wechat_controller.go`
- **路由**: `/api/wechat/*`

### 4. 邀请码配置模块
- **功能**: 邀请码生成、使用统计、有效期管理
- **文件**: `api/invitation_controller.go`
- **路由**: `/api/invitations/*`

### 5. 系统配置模块
- **功能**: 系统参数配置、审计日志
- **文件**: `api/system_controller.go`
- **路由**: `/api/system/*`

### 6. 用户管理模块
- **功能**: 管理员账户管理
- **文件**: `api/user_controller.go`
- **路由**: `/api/users/*`

## 数据库设计

### 核心表结构
- `admin_users` - 管理员用户表
- `user_sessions` - 用户会话表
- `enterprises` - 企业管理表
- `wechat_accounts` - 微信管理表
- `invitation_codes` - 邀请码配置表
- `system_configs` - 系统配置表
- `audit_logs` - 审计日志表

### 关联关系
- 企业 → 邀请人 (admin_users)
- 微信账号 → 创建者/更新者 (admin_users)
- 邀请码 → 邀请人 (admin_users)
- 审计日志 → 操作用户 (admin_users)

## 项目结构

```
├── main.go                 # 主程序入口
├── app.go                  # Wails应用配置
├── config/                 # 配置管理
│   └── config.go          # 应用配置
├── models/                 # 数据模型
│   └── models.go          # 所有数据模型定义
├── database/               # 数据库操作
│   └── database.go        # 数据库连接和迁移
├── migrations/             # 数据库迁移
│   └── migrations.go      # 迁移脚本
├── api/                    # API接口层
│   ├── routes.go          # 路由配置
│   ├── middleware.go      # 中间件
│   ├── auth_controller.go # 认证控制器
│   ├── response.go # 响应体
│   ├── enterprise_controller.go # 企业管理
│   ├── wechat_controller.go     # 微信管理
│   ├── invitation_controller.go # 邀请码管理
│   ├── system_controller.go     # 系统配置
│   └── user_controller.go       # 用户管理
├── core/                   # 核心逻辑
│   └── app_core.go        # 应用核心
├── bootstrap/              # 启动引导
│   └── server_runner.go   # 服务器启动
├── server/                 # HTTP服务器
│   └── server.go          # 服务器实现
├── logger/                 # 日志管理
└── docs/                   # 项目文档
    ├── 开发文档.md         # 详细开发文档
    └── 项目大纲.md         # 本文档
```

## 启动方式

### 1. Wails桌面应用
```bash
go run main.go
```
- 端口: 23355
- 界面: 桌面GUI应用
- 用途: 生产环境

### 2. Air热重载开发
```bash
air
```
- 端口: 23355
- 特性: 代码热重载
- 用途: 开发调试

## 默认配置

- **端口**: 23355
- **数据库**: `./data/app.db`
- **默认账户**: admin / admin123
- **会话超时**: 2小时
- **密码策略**: 8-16位

## API接口

### 认证接口
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `POST /api/auth/change-password` - 修改密码

### 企业管理接口
- `GET /api/enterprises` - 获取企业列表
- `POST /api/enterprises` - 创建企业
- `GET /api/enterprises/:id` - 获取企业详情
- `PUT /api/enterprises/:id` - 更新企业
- `DELETE /api/enterprises/:id` - 删除企业

### 微信管理接口
- `GET /api/wechat` - 获取微信账号列表
- `POST /api/wechat` - 创建微信账号
- `GET /api/wechat/:id` - 获取微信账号详情
- `PUT /api/wechat/:id` - 更新微信账号
- `DELETE /api/wechat/:id` - 删除微信账号

### 统一响应规范

- 所有HTTP请求统一返回HTTP 200，业务状态通过 `code` 字段表达。
- 响应结构如下：

```json
{
  "code": 200,
  "msg": "success",
  "data": {},
  "timestamp": 1693641600
}
```

- 常用业务状态码：
  - 200: 成功
  - 400: 请求参数错误
  - 401: 未认证
  - 403: 权限不足
  - 404: 资源不存在
  - 409: 资源冲突
  - 422: 数据验证失败
  - 429: 请求过于频繁
  - 500: 系统错误

- 使用方式（后端）：
  - 成功：`Success(c, data)` 或 `SuccessWithMsg(c, "操作成功", data)`
  - 错误：`BadRequest(c, msg)`, `Unauthorized(c, msg)`, `Forbidden(c, msg)`, `NotFound(c, msg)`, `Conflict(c, msg)`, `ValidationError(c, msg)`, `InternalServerError(c, msg)`

- 示例：

```go
// 获取列表
Success(c, gin.H{
  "list": items,
  "total": total,
  "page": page,
  "page_size": pageSize,
})

// 业务错误
BadRequest(c, "参数不合法")
```

## 安全特性

- **密码加密**: bcrypt哈希
- **会话管理**: JWT Token
- **访问控制**: 中间件认证
- **审计日志**: 完整操作记录
- **数据验证**: 输入参数校验

## 开发规范

- **代码风格**: 遵循Go官方规范
- **错误处理**: 统一错误响应格式
- **日志记录**: 结构化日志输出
- **API设计**: RESTful风格
- **数据库**: 使用GORM ORM

## 部署说明

### 开发环境
1. 安装Go 1.21+
2. 安装Air: `go install github.com/cosmtrek/air@latest`
3. 运行: `air`

### 生产环境
1. 构建: `wails build`
2. 部署: 运行生成的二进制文件
3. 配置: 修改config/config.go中的配置

## 下一步计划

1. **前端开发**: 实现React/Vue.js界面
2. **功能完善**: 完善邀请码管理逻辑
3. **性能优化**: 添加缓存和连接池
4. **监控告警**: 集成Prometheus + Grafana
5. **容器化**: Docker部署支持
