# 账号和权限系统规划

## 功能定位

为内部资产管理系统提供完整的用户认证和权限控制能力，确保资源访问的安全性和可管理性。

## 核心功能

### 用户管理

- 用户注册/登录/登出
- 用户信息管理
- 用户状态控制（启用/禁用）
- 密码修改和重置
- 最后登录时间记录

### 角色管理

- 预设角色（超级管理员、管理员、编辑者、查看者）
- 自定义角色创建
- 角色权限配置
- 角色分配给用户

### 权限管理

- 原子级权限定义（资源:操作）
- 权限组管理（权限的逻辑分组）
- 自定义权限创建
- 权限直接授予用户
- 支持通配符权限（如 `documents:*`）

### 资源权限

- 细粒度资源访问控制
- 针对特定文件/文件夹的权限
- 权限继承机制
- 临时权限（支持过期时间）

### 权限验证

- JWT Token 认证
- 路由级权限保护
- 资源所有权验证
- 操作审计日志

## 权限模型

### RBAC + 资源级权限

```
用户 → 角色 → 权限组 → 权限
  ↓      ↓       ↓
  └──────┴───────┴──→ 直接授权
```

### 权限计算规则

用户最终权限 = 角色权限 + 角色权限组 + 直接授权权限 + 直接授权权限组

### 资源类型

- `documents` - 文档库
- `models` - 模型库
- `assets` - 资产库
- `textures` - 贴图库
- `projects` - 项目管理
- `ai3d` - AI 3D生成
- `users` - 用户管理
- `roles` - 角色管理
- `permissions` - 权限管理

### 操作类型

- `read` - 查看
- `create` - 创建
- `update` - 更新
- `delete` - 删除
- `download` - 下载
- `upload` - 上传
- `share` - 分享
- `admin` - 管理（包含所有操作）

### 权限示例

```
documents:read          # 查看文档
documents:create        # 创建文档
documents:*             # 文档所有操作
*:read                  # 所有资源的查看权限
*:*                     # 超级管理员权限
```

## 预设角色

### 超级管理员 (super_admin)

- 权限：`*:*`
- 说明：系统最高权限，不可删除

### 管理员 (admin)

- 权限组：用户管理、角色管理、所有资源管理
- 说明：可管理用户和资源，但不能修改超级管理员

### 编辑者 (editor)

- 权限组：资源读写、上传下载
- 说明：可创建、编辑、删除自己的资源

### 查看者 (viewer)

- 权限组：资源只读、下载
- 说明：只能查看和下载资源

## 技术架构

### 认证方式

- JWT Token（已有基础实现）
- Token 过期时间：24小时
- Refresh Token：7天
- 密码加密：bcrypt

### 中间件

- `AuthMiddleware` - 认证中间件
- `RequirePermission` - 权限验证中间件
- `RequireOwnership` - 所有权验证中间件
- `RequireRole` - 角色验证中间件

### 数据层

- Model 层：用户、角色、权限、权限组模型
- Controller 层：用户管理、角色管理、权限管理 API
- Service 层：权限计算、验证逻辑
- 独立配置：JWT 配置、权限配置

## 安全特性

- 密码强度验证
- 登录失败次数限制
- Token 自动刷新
- 操作审计日志（集成现有审计系统）
- IP 黑名单集成
- 敏感操作二次验证
