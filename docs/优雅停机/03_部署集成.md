# éƒ¨ç½²é›†æˆ

## Systemd é…ç½®

### æœåŠ¡æ–‡ä»¶

```ini
# /etc/systemd/system/online_show.service
[Unit]
Description=Online Show Server
After=network.target

[Service]
Type=simple
WorkingDirectory=/root/project/online_show
ExecStart=/root/project/online_show/online_show
Restart=on-failure
RestartSec=5

# ä¼˜é›…åœæœºå…³é”®é…ç½®
TimeoutStopSec=35
KillMode=mixed
KillSignal=SIGTERM

[Install]
WantedBy=multi-user.target
```

**å…³é”®å‚æ•°**:

| å‚æ•°             | å€¼      | è¯´æ˜                                       |
| ---------------- | ------- | ------------------------------------------ |
| `TimeoutStopSec` | 35      | ç­‰å¾…è¿›ç¨‹é€€å‡ºçš„æ—¶é—´ï¼ˆæ¯”ä»£ç ä¸­çš„ 30 ç§’ç•¥é•¿ï¼‰ |
| `KillMode`       | mixed   | å…ˆå‘ SIGTERMï¼Œè¶…æ—¶åå‘ SIGKILL             |
| `KillSignal`     | SIGTERM | ä½¿ç”¨ SIGTERM è§¦å‘ä¼˜é›…åœæœº                  |

---

## éƒ¨ç½²è„šæœ¬ä¿®æ”¹

### build-on-linux.sh ä¿®æ”¹

```bash
# åŸæ¥
sudo systemctl stop online_show

# æ”¹ä¸ºï¼ˆå¢åŠ ç­‰å¾…æ—¶é—´ï¼‰
echo "ä¼˜é›…åœæœºä¸­ï¼Œç­‰å¾…ç°æœ‰è¯·æ±‚å®Œæˆ..."
sudo systemctl stop online_show --timeout=35
```

---

## éªŒè¯ä¼˜é›…åœæœº

### 1. æŸ¥çœ‹æ—¥å¿—

```bash
# åœæ­¢æœåŠ¡
sudo systemctl stop online_show

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ä¼˜é›…åœæœºæµç¨‹
tail -20 /root/project/online_show/app_log.txt
```

**é¢„æœŸæ—¥å¿—**:

```
INFO ğŸ“¡ æ”¶åˆ°ä¿¡å·: terminatedï¼Œå¼€å§‹ä¼˜é›…å…³é—­...
INFO ğŸ”„ å¼€å§‹ä¼˜é›…å…³é—­...
INFO â³ æ­£åœ¨å…³é—­HTTPæœåŠ¡å™¨...
INFO âœ… HTTPæœåŠ¡å™¨å·²å…³é—­
INFO â³ æ­£åœ¨å…³é—­æ•°æ®åº“è¿æ¥...
INFO âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
INFO ğŸ‘‹ ä¼˜é›…å…³é—­å®Œæˆ
```

### 2. å‹åŠ›æµ‹è¯•éªŒè¯

```bash
# ç»ˆç«¯1: æŒç»­å‘é€è¯·æ±‚
while true; do curl -s http://localhost:23347/health && echo; sleep 0.1; done

while true; do curl -s http://api-test.show.linktwins.com/api/health && echo; sleep 0.1; done

# ç»ˆç«¯2: åœæ­¢æœåŠ¡
sudo systemctl stop online_show

# è§‚å¯Ÿç»ˆç«¯1: ç°æœ‰è¯·æ±‚åº”è¯¥æ­£å¸¸å®Œæˆï¼Œç„¶åæ‰å‡ºç°è¿æ¥å¤±è´¥
```

---

## ç›¸å…³æ–‡æ¡£

- [æ¦‚è¿°](./01_æ¦‚è¿°.md)
- [ä»£ç ä¿®æ”¹](./02_ä»£ç ä¿®æ”¹.md)
