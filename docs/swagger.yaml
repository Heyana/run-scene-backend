basePath: /
definitions:
  api.ResourceFile:
    properties:
      created_at:
        example: 1640995200
        type: integer
      file_name:
        example: example.jpg
        type: string
      file_size:
        example: 1048576
        type: integer
      id:
        example: 1
        type: integer
      mime_type:
        example: image/jpeg
        type: string
      storage_type:
        example: cdn
        type: string
      type:
        example: image
        type: string
      url:
        example: https://cdn.example.com/files/example.jpg
        type: string
    type: object
  api.ResourceListResponse:
    properties:
      page:
        example: 1
        type: integer
      page_size:
        example: 10
        type: integer
      resources:
        items:
          $ref: '#/definitions/api.ResourceFile'
        type: array
      total:
        example: 100
        type: integer
    type: object
  api.UploadResourceResponse:
    properties:
      file_name:
        example: example.jpg
        type: string
      file_size:
        example: 1048576
        type: integer
      mime_type:
        example: image/jpeg
        type: string
      resource_id:
        example: 1
        type: integer
      type:
        example: image
        type: string
      url:
        example: https://cdn.example.com/files/example.jpg
        type: string
    type: object
  controllers.BackupHistoryResponse:
    properties:
      limit:
        example: 20
        type: integer
      page:
        example: 1
        type: integer
      records:
        items:
          $ref: '#/definitions/controllers.BackupRecord'
        type: array
      total:
        example: 50
        type: integer
    type: object
  controllers.BackupRecord:
    properties:
      description:
        example: 数据库定时备份
        type: string
      end_time:
        example: 1640995260
        type: integer
      error:
        example: ""
        type: string
      file_path:
        example: /backups/db_20240101_120000.sql
        type: string
      file_size:
        example: 1048576
        type: integer
      id:
        example: 1
        type: integer
      start_time:
        example: 1640995200
        type: integer
      status:
        example: success
        type: string
      type:
        example: database
        type: string
    type: object
  controllers.BackupStatus:
    properties:
      failed_backups:
        example: 2
        type: integer
      last_backup_time:
        example: 1640991600
        type: integer
      next_backup_time:
        example: 1640995200
        type: integer
      running:
        example: true
        type: boolean
      successful_backups:
        example: 23
        type: integer
      total_backups:
        example: 25
        type: integer
    type: object
  controllers.BlockedIP:
    properties:
      blocked_at:
        example: 1640995200
        type: integer
      duration:
        example: 3600
        type: integer
      expires_at:
        example: 1640998800
        type: integer
      ip:
        example: 192.168.1.100
        type: string
      reason:
        example: 恶意攻击
        type: string
    type: object
  controllers.ConnectionStats:
    properties:
      active_connections:
        example: 10
        type: integer
      ip_connections:
        additionalProperties:
          format: int64
          type: integer
        type: object
      top_ips:
        items:
          $ref: '#/definitions/controllers.IPStats'
        type: array
      total_connections:
        example: 25
        type: integer
    type: object
  controllers.IPStats:
    properties:
      ip:
        example: 192.168.1.1
        type: string
      is_blocked:
        example: false
        type: boolean
      is_whitelisted:
        example: false
        type: boolean
      last_access:
        example: 1640995200
        type: integer
      request_count:
        example: 150
        type: integer
    type: object
  controllers.SecurityStatus:
    properties:
      config: {}
      rate_limiter_active:
        example: true
        type: boolean
      threat_level:
        example: low
        type: string
      uptime:
        example: 3600
        type: integer
    type: object
  response.Response:
    properties:
      code:
        allOf:
        - $ref: '#/definitions/response.ResponseCode'
        description: 业务状态码
      data:
        description: 数据
      msg:
        description: 消息
        type: string
      timestamp:
        description: 时间戳
        type: integer
    type: object
  response.ResponseCode:
    enum:
    - 200
    - 400
    - 401
    - 403
    - 404
    - 405
    - 409
    - 422
    - 429
    - 500
    - 501
    - 502
    - 503
    type: integer
    x-enum-varnames:
    - CodeSuccess
    - CodeBadRequest
    - CodeUnauthorized
    - CodeForbidden
    - CodeNotFound
    - CodeMethodNotAllowed
    - CodeConflict
    - CodeUnprocessableEntity
    - CodeTooManyRequests
    - CodeInternalServerError
    - CodeNotImplemented
    - CodeBadGateway
    - CodeServiceUnavailable
host: localhost:23347
info:
  contact:
    email: support@example.com
    name: API Support
    url: http://www.example.com/support
  description: 媒体管理器 API 文档，包括媒体库管理、媒体文件管理等功能
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: http://swagger.io/terms/
  title: 媒体管理器 API
  version: "1.0"
paths:
  /api/backup/cdn:
    post:
      consumes:
      - application/json
      description: 单独执行CDN文件的增量备份操作
      produces:
      - application/json
      responses:
        "200":
          description: CDN备份任务已触发
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 触发失败或调度器未初始化
          schema:
            $ref: '#/definitions/response.Response'
      summary: 手动触发CDN增量备份
      tags:
      - 备份管理
  /api/backup/database:
    post:
      consumes:
      - application/json
      description: 单独执行数据库备份操作，不包括CDN文件
      produces:
      - application/json
      responses:
        "200":
          description: 数据库备份任务已触发
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 触发失败或调度器未初始化
          schema:
            $ref: '#/definitions/response.Response'
      summary: 手动触发数据库备份
      tags:
      - 备份管理
  /api/backup/history:
    get:
      consumes:
      - application/json
      description: 获取系统所有备份操作的历史记录，包括成功和失败的备份
      parameters:
      - default: 1
        description: 页码，默认1
        in: query
        name: page
        type: integer
      - default: 20
        description: 每页数量，默认20，最大100
        in: query
        name: limit
        type: integer
      - description: 备份类型筛选：database | cdn | full
        in: query
        name: type
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/controllers.BackupHistoryResponse'
              type: object
        "500":
          description: 获取失败或调度器未初始化
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取备份历史记录
      tags:
      - 备份管理
  /api/backup/restore/cdn/{backup_id}:
    post:
      consumes:
      - application/json
      description: 使用指定的备份记录恢复CDN文件到指定状态（谨慎操作）
      parameters:
      - description: '备份记录ID（示例: 1）'
        in: path
        name: backup_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: CDN文件恢复成功
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: 无效的备份 ID
          schema:
            $ref: '#/definitions/response.Response'
        "404":
          description: 备份记录不存在
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 恢复失败或调度器未初始化
          schema:
            $ref: '#/definitions/response.Response'
      summary: 从备份恢复CDN文件
      tags:
      - 备份管理
  /api/backup/status:
    get:
      consumes:
      - application/json
      description: 获取当前备份调度器和备份服务的运行状态信息
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/controllers.BackupStatus'
              type: object
        "500":
          description: 备份调度器未初始化
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取备份系统状态
      tags:
      - 备份管理
  /api/backup/trigger:
    post:
      consumes:
      - application/json
      description: 立即执行一次完整的系统备份，包括数据库和CDN文件
      produces:
      - application/json
      responses:
        "200":
          description: 备份任务已触发
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 触发失败或调度器未初始化
          schema:
            $ref: '#/definitions/response.Response'
      summary: 手动触发全量备份
      tags:
      - 备份管理
  /api/ping:
    get:
      consumes:
      - application/json
      description: 检查API服务是否正常运行
      produces:
      - application/json
      responses:
        "200":
          description: 服务正常
          schema:
            $ref: '#/definitions/response.Response'
      summary: 健康检查
      tags:
      - 系统
  /api/resources:
    get:
      consumes:
      - application/json
      description: 获取系统中所有资源文件的列表，支持分页和类型筛选
      parameters:
      - default: 1
        description: 页码，默认1
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页数量，默认10，最大100
        in: query
        name: page_size
        type: integer
      - description: 资源类型筛选：image | video | audio | document
        in: query
        name: type
        type: string
      - description: 媒体库ID筛选
        in: query
        name: library_id
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/api.ResourceListResponse'
              type: object
        "500":
          description: 查询失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取资源文件列表
      tags:
      - 资源管理
  /api/resources/{id}:
    delete:
      consumes:
      - application/json
      description: 永久删除指定的资源文件，包括本地和CDN存储
      parameters:
      - description: '资源ID（示例: 1）'
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: 无效的资源ID
          schema:
            $ref: '#/definitions/response.Response'
        "404":
          description: 资源不存在
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 删除失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 删除资源文件
      tags:
      - 资源管理
    get:
      description: 根据ID获取资源文件，返回文件内容或重定向到CDN地址
      parameters:
      - description: '资源ID（示例: 1）'
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/octet-stream
      - image/*
      - text/*
      responses:
        "200":
          description: 资源文件内容
          schema:
            type: file
        "302":
          description: CDN重定向
          schema:
            type: string
        "400":
          description: 无效的资源ID
          schema:
            $ref: '#/definitions/response.Response'
        "404":
          description: 资源不存在或内容不可用
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取资源文件
      tags:
      - 资源管理
  /api/resources/upload:
    post:
      consumes:
      - multipart/form-data
      description: 上传各类资源文件（图片、文档、音频、视频等）到系统
      parameters:
      - description: 资源文件（最大10MB）
        in: formData
        name: file
        required: true
        type: file
      - description: 媒体库ID，可选
        in: query
        name: library_id
        type: integer
      - description: 资源类型（系统自动识别）
        in: formData
        name: resource_type
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 上传成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/api.UploadResourceResponse'
              type: object
        "400":
          description: 文件上传失败或文件过大
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 保存失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 上传资源文件
      tags:
      - 资源管理
  /api/security/block/{ip}:
    post:
      consumes:
      - application/json
      description: 将指定IP地址添加到黑名单，阻止其访问系统
      parameters:
      - description: 'IP地址（示例: 192.168.1.100）'
        in: path
        name: ip
        required: true
        type: string
      - default: 3600
        description: 封禁时长(秒)，默认3600
        in: query
        name: duration
        type: integer
      - default: '"手动封禁"'
        description: 封禁原因
        in: query
        name: reason
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 封禁成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/controllers.BlockedIP'
              type: object
        "400":
          description: IP地址格式错误或已被封禁
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 封禁失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 手动封禁IP地址
      tags:
      - 安全管理
  /api/security/blocked-ips:
    get:
      consumes:
      - application/json
      description: 获取当前被封禁的IP地址列表，包括封禁原因和到期时间
      parameters:
      - default: 1
        description: 页码，默认1
        in: query
        name: page
        type: integer
      - default: 20
        description: 每页数量，默认20
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/controllers.BlockedIP'
                  type: array
              type: object
        "500":
          description: 获取失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取被封禁IP列表
      tags:
      - 安全管理
  /api/security/connections:
    get:
      consumes:
      - application/json
      description: 获取当前活跃连接统计信息，用于DDoS监控和流量分析
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/controllers.ConnectionStats'
              type: object
        "500":
          description: 获取失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取实时连接统计
      tags:
      - 安全管理
  /api/security/ip-stats:
    get:
      consumes:
      - application/json
      description: 获取各IP地址的访问次数、最后访问时间等统计信息
      parameters:
      - default: 1
        description: 页码，默认1
        in: query
        name: page
        type: integer
      - default: 50
        description: 每页数量，默认50
        in: query
        name: limit
        type: integer
      - default: '"request_count"'
        description: 排序方式：request_count(请求数) | last_access(最后访问)
        in: query
        name: sort
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/controllers.IPStats'
                  type: array
              type: object
        "500":
          description: 获取失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取IP访问统计
      tags:
      - 安全管理
  /api/security/status:
    get:
      consumes:
      - application/json
      description: 获取当前安全中间件运行状态、配置信息和威胁等级
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  $ref: '#/definitions/controllers.SecurityStatus'
              type: object
        "500":
          description: 获取失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 获取系统安全状态
      tags:
      - 安全管理
  /api/security/unblock/{ip}:
    post:
      consumes:
      - application/json
      description: 将指定IP地址从黑名单中移除，恢复其正常访问权限
      parameters:
      - description: 'IP地址（示例: 192.168.1.100）'
        in: path
        name: ip
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 解封成功
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: IP地址格式错误
          schema:
            $ref: '#/definitions/response.Response'
        "404":
          description: IP未被封禁
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 解封失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 手动解封IP地址
      tags:
      - 安全管理
  /api/security/whitelist/{ip}:
    delete:
      consumes:
      - application/json
      description: 将IP地址从白名单中移除，该IP将重新受到安全检查
      parameters:
      - description: 'IP地址（示例: 192.168.1.1）'
        in: path
        name: ip
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 移除成功
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: IP地址格式错误
          schema:
            $ref: '#/definitions/response.Response'
        "404":
          description: IP不在白名单中
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 移除失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 从白名单移除IP
      tags:
      - 安全管理
    post:
      consumes:
      - application/json
      description: 将IP地址添加到白名单，该IP将绕过所有安全检查
      parameters:
      - description: 'IP地址（示例: 192.168.1.1）'
        in: path
        name: ip
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 添加成功
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: IP地址格式错误或已在白名单
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 添加失败
          schema:
            $ref: '#/definitions/response.Response'
      summary: 添加IP到白名单
      tags:
      - 安全管理
schemes:
- http
swagger: "2.0"
tags:
- description: 系统相关操作
  name: 系统
- description: 浏览器扩展相关操作
  name: 扩展
- description: 媒体库管理操作
  name: 媒体库
- description: 媒体文件管理操作
  name: 媒体管理
- description: 备份和恢复操作
  name: 备份管理
- description: 安全和IP管理操作
  name: 安全管理
- description: 资源文件管理操作
  name: 资源管理
