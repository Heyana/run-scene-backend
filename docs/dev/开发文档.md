# 企业名片后台管理系统开发文档

## 项目概述
这是一个后台项目，包含一个支持 wails 和 air 启动的后台系统。功能是为一个后台管理的项目提供支持，这是我们公司的内部后台管理的部分，需要部署到公网管理其他项目的一些数据。

## 技术栈

### 后端技术栈
- **语言**: Go (Golang)
- **Web框架**: Gin (轻量级HTTP框架)
- **数据库**: SQLite (本地数据库) + 定期同步备份
- **ORM**: GORM (Go语言的ORM库)
- **认证**: JWT (JSON Web Token)
- **密码加密**: bcrypt/Argon2
- **启动方式**: 
  - Wails (桌面应用集成)
  - Air (热重载开发环境)

### 前端技术栈
- **框架**: React/Vue.js (现代前端框架)
- **UI组件库**: Ant Design/Element UI
- **状态管理**: Redux/Vuex
- **路由**: React Router/Vue Router
- **构建工具**: Vite/Webpack

### 部署和运维
- **容器化**: Docker
- **反向代理**: Nginx
- **HTTPS**: Let's Encrypt
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack

## 核心功能模块

### 1. 用户认证模块
- 内置账号登录
- 密码修改功能
- 忘记密码重置
- 会话管理
- 多因素认证 (MFA)

### 2. 企业管理模块
- 企业信息管理
- 企业列表展示
- 企业信息编辑
- 搜索和筛选功能

### 3. 微信管理模块
- 微信账号管理
- 微信ID和昵称管理
- 手机号关联
- 微信账号创建时间记录

### 4. 邀请码配置模块
- 邀请码生成和管理
- 邀请人信息管理
- 邀请码使用统计
- 邀请码有效期管理

### 5. 账户管理模块
- 管理员账户管理
- 密码修改
- 账户信息更新
- 退出登录功能

## 后台数据结构模块

### 用户认证相关表

#### AdminUser (管理员用户表)
```sql
CREATE TABLE admin_users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    phone_number VARCHAR(20) NOT NULL,
    email VARCHAR(100),
    role VARCHAR(20) DEFAULT 'admin',
    status VARCHAR(20) DEFAULT 'active',
    last_login_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER,
    updated_by INTEGER
);
```

#### UserSession (用户会话表)
```sql
CREATE TABLE user_sessions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    session_token VARCHAR(255) UNIQUE NOT NULL,
    expires_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    ip_address VARCHAR(45),
    user_agent TEXT,
    FOREIGN KEY (user_id) REFERENCES admin_users(id)
);
```

#### PasswordReset (密码重置表)
```sql
CREATE TABLE password_resets (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    reset_token VARCHAR(255) UNIQUE NOT NULL,
    expires_at DATETIME NOT NULL,
    used_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES admin_users(id)
);
```

### 业务数据表

#### Enterprise (企业管理表)
```sql
CREATE TABLE enterprises (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    company_name VARCHAR(200) NOT NULL,
    phone_number VARCHAR(20) NOT NULL,
    inviter_id INTEGER NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    status VARCHAR(20) DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER,
    updated_by INTEGER,
    FOREIGN KEY (inviter_id) REFERENCES admin_users(id),
    FOREIGN KEY (created_by) REFERENCES admin_users(id),
    FOREIGN KEY (updated_by) REFERENCES admin_users(id)
);
```

#### WeChatAccount (微信管理表)
```sql
CREATE TABLE wechat_accounts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    wechat_id VARCHAR(100) UNIQUE NOT NULL,
    nickname VARCHAR(100) NOT NULL,
    phone_number VARCHAR(20) NOT NULL,
    status VARCHAR(20) DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER,
    updated_by INTEGER,
    FOREIGN KEY (created_by) REFERENCES admin_users(id),
    FOREIGN KEY (updated_by) REFERENCES admin_users(id)
);
```

#### InvitationCode (邀请码配置表)
```sql
CREATE TABLE invitation_codes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inviter_id INTEGER NOT NULL,
    invitation_code VARCHAR(20) UNIQUE NOT NULL,
    phone_number VARCHAR(20) NOT NULL,
    status VARCHAR(20) DEFAULT 'active',
    usage_limit INTEGER DEFAULT 1,
    times_used INTEGER DEFAULT 0,
    expiration_date DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER,
    updated_by INTEGER,
    FOREIGN KEY (inviter_id) REFERENCES admin_users(id),
    FOREIGN KEY (created_by) REFERENCES admin_users(id),
    FOREIGN KEY (updated_by) REFERENCES admin_users(id)
);
```

### 系统配置表

#### SystemConfig (系统配置表)
```sql
CREATE TABLE system_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    config_key VARCHAR(100) UNIQUE NOT NULL,
    config_value TEXT,
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### AuditLog (审计日志表)
```sql
CREATE TABLE audit_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    action VARCHAR(100) NOT NULL,
    resource_type VARCHAR(50),
    resource_id INTEGER,
    details TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES admin_users(id)
);
```

## 安全策略

### 1. 密码安全策略
- **密码复杂度要求**:
  - 最小长度: 8位
  - 最大长度: 16位
  - 必须包含: 大小写字母、数字、特殊字符
  - 禁止使用常见弱密码
  - 禁止使用连续字符或重复字符

- **密码存储安全**:
  - 使用 bcrypt 或 Argon2 算法进行密码哈希
  - 盐值长度至少16字节
  - 哈希轮数: bcrypt cost factor ≥ 12

- **密码策略**:
  - 强制首次登录修改默认密码
  - 密码有效期: 90天
  - 密码历史记录: 最近5次密码不能重复
  - 密码失败锁定: 连续5次失败后锁定账户15分钟

### 2. 访问控制策略
- **角色基础访问控制 (RBAC)**:
  - 超级管理员: 完全访问权限
  - 系统管理员: 系统配置和用户管理
  - 业务管理员: 业务数据管理
  - 只读用户: 仅查看权限

- **权限矩阵**:
  - 企业管理: 创建、读取、更新、删除
  - 微信管理: 创建、读取、更新、删除
  - 邀请码配置: 创建、读取、更新、删除
  - 账户管理: 读取、更新自己的账户信息

### 3. 会话安全策略
- **JWT Token 安全**:
  - Token 有效期: 2小时
  - 刷新Token有效期: 7天
  - Token 签名算法: HS256/RS256
  - Token 黑名单机制

- **会话管理**:
  - 单点登录 (SSO) 支持
  - 会话超时自动登出
  - 异常登录检测和通知
  - 多设备登录控制

### 4. 数据安全策略
- **数据加密**:
  - 敏感数据字段加密存储 (AES-256)
  - 数据库文件加密
  - 传输数据HTTPS加密
  - API接口数据签名验证

- **数据备份策略**:
  - 每日增量备份
  - 每周全量备份
  - 异地备份存储
  - 备份数据加密

### 5. 网络安全策略
- **API安全**:
  - 请求频率限制 (Rate Limiting)
  - API密钥认证
  - 请求签名验证
  - CORS策略配置

- **防护措施**:
  - SQL注入防护
  - XSS攻击防护
  - CSRF攻击防护
  - 文件上传安全验证

### 6. 审计和监控
- **操作审计**:
  - 所有敏感操作记录日志
  - 用户登录/登出记录
  - 数据变更记录
  - 权限变更记录

- **安全监控**:
  - 异常登录检测
  - 敏感操作告警
  - 系统性能监控
  - 安全事件响应

## 部署和运维

### 1. 环境配置
- **开发环境**: 使用 Air 进行热重载开发
- **测试环境**: 独立测试数据库和配置
- **生产环境**: 生产级数据库和配置

### 2. 数据库同步策略
- **主从复制**: 主数据库写入，从数据库读取
- **定期同步**: 每小时数据同步检查
- **数据一致性**: 定期数据完整性校验
- **故障恢复**: 自动故障检测和切换

### 3. 监控和告警
- **系统监控**: CPU、内存、磁盘使用率
- **应用监控**: 响应时间、错误率、吞吐量
- **数据库监控**: 连接数、查询性能、锁等待
- **告警机制**: 邮件、短信、钉钉通知

## 开发规范

### 1. 代码规范
- 遵循 Go 官方代码规范
- 使用 gofmt 格式化代码
- 添加必要的注释和文档
- 单元测试覆盖率 ≥ 80%

### 2. 版本控制
- 使用 Git 进行版本控制
- 遵循 Git Flow 工作流
- 提交信息规范化
- 代码审查机制

### 3. 部署流程
- 自动化构建和测试
- 蓝绿部署策略
- 回滚机制
- 部署监控和告警

## 风险评估和应对

### 1. 安全风险
- **数据泄露风险**: 实施数据分类和访问控制
- **账户劫持风险**: 多因素认证和异常检测
- **系统攻击风险**: 定期安全扫描和漏洞修复

### 2. 业务风险
- **数据丢失风险**: 多重备份和恢复机制
- **服务中断风险**: 高可用架构和故障转移
- **合规风险**: 定期合规检查和审计

## 总结

本系统作为企业级后台管理系统，需要重点关注安全性、稳定性和可维护性。通过完善的技术架构、严格的安全策略和规范的数据结构设计，确保系统能够安全、稳定地运行在公网环境中，为企业提供可靠的后台管理服务。
