# 需求管理平台 - 前端架构

## 目录结构

```
src/
  ├── views/
  │   ├── RequirementManagement/
  │   │   ├── index.tsx                    # 主入口
  │   │   ├── CompanyList.tsx              # 公司列表
  │   │   ├── CompanyDetail.tsx            # 公司详情
  │   │   ├── ProjectList.tsx              # 项目列表
  │   │   ├── ProjectDetail.tsx            # 项目详情
  │   │   ├── MissionBoard.tsx             # 需求看板
  │   │   ├── MissionList.tsx              # 需求列表
  │   │   ├── MissionDetail.tsx            # 需求详情
  │   │   └── Statistics.tsx               # 统计报表
  │
  ├── components/
  │   ├── MissionCard.tsx                  # 需求卡片
  │   ├── MissionForm.tsx                  # 需求表单
  │   ├── CommentList.tsx                  # 评论列表
  │   ├── AttachmentList.tsx               # 附件列表
  │   ├── MissionRelations.tsx             # 需求关联
  │   ├── MemberSelector.tsx               # 成员选择器
  │   ├── StatusTag.tsx                    # 状态标签
  │   ├── PriorityTag.tsx                  # 优先级标签
  │   └── BurndownChart.tsx                # 燃尽图
  │
  ├── api/
  │   └── models/
  │       ├── company.ts
  │       ├── project.ts
  │       ├── mission.ts
  │       └── statistics.ts
  │
  ├── stores/
  │   ├── companyStore.ts
  │   ├── projectStore.ts
  │   └── missionStore.ts
  │
  └── types/
      ├── company.ts
      ├── project.ts
      └── mission.ts
```

## 路由设计

```typescript
const routes = [
  {
    path: "/requirement-management",
    component: RequirementManagement,
    children: [
      { path: "", redirect: "/requirement-management/companies" },
      { path: "companies", component: CompanyList },
      { path: "companies/:companyId", component: CompanyDetail },
      { path: "companies/:companyId/projects", component: ProjectList },
      { path: "projects/:projectId", component: ProjectDetail },
      {
        path: "projects/:projectId/mission-lists/:listId",
        component: MissionList,
      },
      { path: "projects/:projectId/board", component: MissionBoard },
      { path: "missions/:missionId", component: MissionDetail },
      { path: "projects/:projectId/statistics", component: Statistics },
    ],
  },
];
```

## 核心组件设计

### views/MissionBoard.tsx

```typescript
interface MissionBoardProps {
  projectId: string
  missionListId: string
}

const MissionBoard = defineComponent({
  setup(props) {
    const columns = ref<Column[]>([])
    const missions = ref<Mission[]>([])

    const loadMissions = async (): Promise<void>
    const handleDragEnd = (result: DragResult): void
    const handleCreateMission = (status: string): void
    const handleUpdateMission = (mission: Mission): void

    return () => (
      <div class="mission-board">
        <BoardColumn
          v-for={column in columns}
          missions={getMissionsByStatus(column.status)}
          onDrop={handleDragEnd}
        />
      </div>
    )
  }
})
```

### views/MissionDetail.tsx

```typescript
const MissionDetail = defineComponent({
  setup() {
    const mission = ref<Mission | null>(null)
    const comments = ref<Comment[]>([])
    const attachments = ref<Attachment[]>([])
    const relations = ref<MissionRelation[]>([])

    const loadMissionDetail = async (): Promise<void>
    const handleUpdateField = async (field: string, value: any): Promise<void>
    const handleAddComment = async (content: string): Promise<void>
    const handleUploadAttachment = async (file: File): Promise<void>
    const handleCreateRelation = async (targetId: number, type: string): Promise<void>

    return () => (
      <div class="mission-detail">
        <MissionHeader mission={mission.value} />
        <MissionContent mission={mission.value} onUpdate={handleUpdateField} />
        <CommentList comments={comments.value} onAdd={handleAddComment} />
        <AttachmentList attachments={attachments.value} onUpload={handleUploadAttachment} />
        <MissionRelations relations={relations.value} onCreate={handleCreateRelation} />
      </div>
    )
  }
})
```

### components/MissionCard.tsx

```typescript
interface MissionCardProps {
  mission: Mission
  draggable?: boolean
  onClick?: (mission: Mission) => void
}

const MissionCard = defineComponent({
  props: ['mission', 'draggable', 'onClick'],
  setup(props) {
    return () => (
      <Card
        class="mission-card"
        hoverable
        onClick={() => props.onClick?.(props.mission)}
      >
        <div class="mission-header">
          <PriorityTag priority={props.mission.priority} />
          <StatusTag status={props.mission.status} />
        </div>
        <div class="mission-title">{props.mission.title}</div>
        <div class="mission-meta">
          <Avatar user={props.mission.assignee} />
          <span>{formatDate(props.mission.due_date)}</span>
        </div>
      </Card>
    )
  }
})
```

### components/CommentList.tsx

```typescript
interface CommentListProps {
  comments: Comment[]
  onAdd: (content: string) => void
  onDelete?: (id: number) => void
}

const CommentList = defineComponent({
  props: ['comments', 'onAdd', 'onDelete'],
  setup(props) {
    const newComment = ref('')

    const handleSubmit = (): void
    const handleReply = (parentId: number): void

    return () => (
      <div class="comment-list">
        <CommentInput
          v-model:value={newComment.value}
          onSubmit={handleSubmit}
        />
        <Timeline>
          {props.comments.map(comment => (
            <CommentItem
              comment={comment}
              onReply={handleReply}
              onDelete={props.onDelete}
            />
          ))}
        </Timeline>
      </div>
    )
  }
})
```

## API封装

### api/models/mission.ts

```typescript
export const missionApi = {
  createMission: (listId: number, data: CreateMissionRequest): Promise<ApiResponse<Mission>>
  getMissionList: (listId: number, filters: MissionFilters): Promise<ApiResponse<MissionListResponse>>
  getMissionDetail: (id: number): Promise<ApiResponse<Mission>>
  updateMission: (id: number, data: UpdateMissionRequest): Promise<ApiResponse<Mission>>
  deleteMission: (id: number): Promise<ApiResponse<void>>
  batchUpdateStatus: (ids: number[], status: string): Promise<ApiResponse<void>>
  addComment: (id: number, content: string): Promise<ApiResponse<Comment>>
  uploadAttachment: (id: number, file: File): Promise<ApiResponse<Attachment>>
  createRelation: (id: number, targetId: number, type: string): Promise<ApiResponse<MissionRelation>>
}
```

## 状态管理

### stores/missionStore.ts

```typescript
export const useMissionStore = defineStore('mission', {
  state: () => ({
    missions: [] as Mission[],
    currentMission: null as Mission | null,
    filters: {} as MissionFilters,
    loading: false
  }),

  actions: {
    async fetchMissions(listId: number): Promise<void>
    async fetchMissionDetail(id: number): Promise<void>
    async createMission(data: CreateMissionRequest): Promise<void>
    async updateMission(id: number, data: UpdateMissionRequest): Promise<void>
    async deleteMission(id: number): Promise<void>
    async updateStatus(id: number, status: string): Promise<void>
    setFilters(filters: MissionFilters): void
  },

  getters: {
    getMissionsByStatus: (state) => (status: string) => Mission[]
    getMissionsByPriority: (state) => (priority: string) => Mission[]
    getOverdueMissions: (state) => Mission[]
  }
})
```

## 实时更新

```typescript
// WebSocket连接
const ws = new WebSocket("ws://localhost:8080/ws");

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);

  switch (data.type) {
    case "mission_updated":
      missionStore.updateMissionInList(data.mission);
      break;
    case "mission_commented":
      missionStore.addComment(data.comment);
      break;
    case "mission_status_changed":
      missionStore.updateMissionStatus(data.mission_id, data.status);
      break;
  }
};
```

## 性能优化

- 虚拟滚动（大量需求列表）
- 图片懒加载
- 防抖搜索
- 路由懒加载
- 组件按需加载
- 缓存已加载数据
