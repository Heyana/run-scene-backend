# 文件库数据模型

## Document 文档主表

```go
type Document struct {
    ID            uint       `gorm:"primaryKey" json:"id"`
    Name          string     `gorm:"size:200;index" json:"name"`
    Description   string     `gorm:"type:text" json:"description"`
    Category      string     `gorm:"size:50;index" json:"category"`
    Tags          string     `gorm:"type:text" json:"tags"`
    Type          string     `gorm:"size:20;index" json:"type"` // document, video, archive, other

    // 文件信息
    FileSize      int64      `json:"file_size"`
    FilePath      string     `gorm:"size:512" json:"file_path"`
    FileHash      string     `gorm:"size:64;index" json:"file_hash"`
    Format        string     `gorm:"size:20" json:"format"` // pdf, docx, mp4, zip

    // 预览
    ThumbnailPath string     `gorm:"size:512" json:"thumbnail_path"`
    PreviewPath   string     `gorm:"size:512" json:"preview_path"` // PDF转图片预览

    // 版本控制
    Version       string     `gorm:"size:20" json:"version"`
    ParentID      *uint      `json:"parent_id"` // 父版本ID
    IsLatest      bool       `gorm:"default:true;index" json:"is_latest"`

    // 权限
    Department    string     `gorm:"size:50;index" json:"department"`
    Project       string     `gorm:"size:100;index" json:"project"`
    IsPublic      bool       `gorm:"default:false" json:"is_public"`

    // 统计
    DownloadCount int        `gorm:"default:0;index" json:"download_count"`
    ViewCount     int        `gorm:"default:0" json:"view_count"`
    LastViewedAt  *time.Time `json:"last_viewed_at"`

    // 上传信息
    UploadedBy    string     `gorm:"size:100" json:"uploaded_by"`
    UploadIP      string     `gorm:"size:50" json:"upload_ip"`

    CreatedAt     time.Time  `json:"created_at"`
    UpdatedAt     time.Time  `json:"updated_at"`

    // 虚拟字段
    FileURL       string     `gorm:"-" json:"file_url"`
    ThumbnailURL  string     `gorm:"-" json:"thumbnail_url"`
    PreviewURL    string     `gorm:"-" json:"preview_url"`
}
```

## DocumentMetadata 文档元数据

```go
type DocumentMetadata struct {
    ID          uint      `gorm:"primaryKey" json:"id"`
    DocumentID  uint      `gorm:"uniqueIndex" json:"document_id"`

    // 文档元数据
    PageCount   int       `json:"page_count,omitempty"` // PDF页数
    Author      string    `gorm:"size:100" json:"author,omitempty"`
    Title       string    `gorm:"size:200" json:"title,omitempty"`
    Subject     string    `gorm:"size:200" json:"subject,omitempty"`

    // 视频元数据
    Duration    float64   `json:"duration,omitempty"`
    Width       int       `json:"width,omitempty"`
    Height      int       `json:"height,omitempty"`
    FrameRate   float64   `json:"frame_rate,omitempty"`
    Codec       string    `gorm:"size:50" json:"codec,omitempty"`

    CreatedAt   time.Time `json:"created_at"`
    UpdatedAt   time.Time `json:"updated_at"`
}
```

## DocumentAccessLog 访问日志

```go
type DocumentAccessLog struct {
    ID          uint      `gorm:"primaryKey" json:"id"`
    DocumentID  uint      `gorm:"index" json:"document_id"`
    Action      string    `gorm:"size:20;index" json:"action"` // view, download, upload, delete
    UserName    string    `gorm:"size:100;index" json:"user_name"`
    UserIP      string    `gorm:"size:50" json:"user_ip"`
    CreatedAt   time.Time `gorm:"index" json:"created_at"`
}
```

## DocumentMetrics 统计指标

```go
type DocumentMetrics struct {
    ID            uint      `gorm:"primaryKey" json:"id"`
    Date          string    `gorm:"uniqueIndex:idx_date_type;size:10" json:"date"`
    Type          string    `gorm:"uniqueIndex:idx_date_type;size:20" json:"type"`
    TotalDocs     int       `json:"total_docs"`
    TotalSize     int64     `json:"total_size"`
    UploadCount   int       `json:"upload_count"`
    DownloadCount int       `json:"download_count"`
    CreatedAt     time.Time `json:"created_at"`
    UpdatedAt     time.Time `json:"updated_at"`
}
```

## 文件类型映射

```go
// 文档类型分类
const (
    TypeDocument = "document" // PDF, Word, Excel, PPT, TXT
    TypeVideo    = "video"    // MP4, WebM, AVI, MOV
    TypeArchive  = "archive"  // ZIP, RAR, 7Z
    TypeOther    = "other"    // 其他类型
)

// 格式到类型的映射
var FormatTypeMap = map[string]string{
    "pdf":  TypeDocument,
    "doc":  TypeDocument,
    "docx": TypeDocument,
    "xls":  TypeDocument,
    "xlsx": TypeDocument,
    "ppt":  TypeDocument,
    "pptx": TypeDocument,
    "txt":  TypeDocument,
    "md":   TypeDocument,

    "mp4":  TypeVideo,
    "webm": TypeVideo,
    "avi":  TypeVideo,
    "mov":  TypeVideo,

    "zip":  TypeArchive,
    "rar":  TypeArchive,
    "7z":   TypeArchive,
}
```
