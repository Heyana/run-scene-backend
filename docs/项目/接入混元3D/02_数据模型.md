# 混元3D接入 - 数据模型

## 数据库模型

### HunyuanTask 任务表

```go
type HunyuanTask struct {
    ID        uint      `gorm:"primaryKey" json:"id"`
    CreatedAt time.Time `json:"createdAt"`
    UpdatedAt time.Time `json:"updatedAt"`

    // 任务信息
    JobID       string `gorm:"size:64;uniqueIndex" json:"jobId"`
    Status      string `gorm:"size:20;index" json:"status"` // WAIT/RUN/DONE/FAIL

    // 输入参数
    InputType   string  `gorm:"size:20" json:"inputType"`   // text/image/multi_view
    Prompt      *string `gorm:"type:text" json:"prompt"`
    ImageURL    *string `gorm:"size:512" json:"imageUrl"`

    // 生成配置
    Model          string  `gorm:"size:10;default:'3.1'" json:"model"`
    FaceCount      *int    `json:"faceCount"`
    GenerateType   string  `gorm:"size:20;default:'Normal'" json:"generateType"`
    EnablePBR      bool    `gorm:"default:true" json:"enablePbr"`
    ResultFormat   string  `gorm:"size:20;default:'GLB'" json:"resultFormat"`

    // 结果
    ErrorCode      *string `gorm:"size:100" json:"errorCode"`
    ErrorMessage   *string `gorm:"type:text" json:"errorMessage"`
    ResultFiles    *string `gorm:"type:text" json:"resultFiles"` // JSON数组

    // 文件存储
    LocalPath      *string `gorm:"size:512" json:"localPath"`      // 本地存储路径
    NASPath        *string `gorm:"size:512" json:"nasPath"`        // NAS存储路径
    ThumbnailPath  *string `gorm:"size:512" json:"thumbnailPath"`  // 预览图路径
    FileSize       *int64  `json:"fileSize"`                       // 文件大小
    FileHash       *string `gorm:"size:64" json:"fileHash"`        // 文件哈希

    // 元数据
    Name        string  `gorm:"size:200" json:"name"`        // 模型名称
    Description *string `gorm:"type:text" json:"description"` // 描述
    Tags        *string `gorm:"type:text" json:"tags"`       // 标签（JSON数组）
    Category    string  `gorm:"size:100;default:'AI生成'" json:"category"`

    // 用户信息
    CreatedBy   string `gorm:"size:100" json:"createdBy"`
    CreatedIP   string `gorm:"size:50" json:"createdIp"`
}
```

### HunyuanConfig 配置表

```go
type HunyuanConfig struct {
    ID        uint      `gorm:"primaryKey" json:"id"`
    UpdatedAt time.Time `json:"updatedAt"`

    // API配置
    SecretID  string `gorm:"size:200;not null" json:"secretId"`
    SecretKey string `gorm:"size:200;not null" json:"secretKey"`
    Region    string `gorm:"size:50;default:'ap-guangzhou'" json:"region"`

    // 默认参数
    DefaultModel        string `gorm:"size:10;default:'3.1'" json:"defaultModel"`
    DefaultFaceCount    int    `gorm:"default:500000" json:"defaultFaceCount"`
    DefaultGenerateType string `gorm:"size:20;default:'Normal'" json:"defaultGenerateType"`
    DefaultEnablePBR    bool   `gorm:"default:true" json:"defaultEnablePbr"`
    DefaultResultFormat string `gorm:"size:20;default:'GLB'" json:"defaultResultFormat"`

    // 任务控制
    MaxConcurrent int `gorm:"default:3" json:"maxConcurrent"`
    PollInterval  int `gorm:"default:5" json:"pollInterval"` // 秒

    // 存储配置
    LocalStorageEnabled bool   `gorm:"default:true" json:"localStorageEnabled"`
    StorageDir          string `gorm:"size:200;default:'static/hunyuan'" json:"storageDir"`
    BaseURL             string `gorm:"size:200" json:"baseUrl"`
    NASEnabled          bool   `gorm:"default:false" json:"nasEnabled"`
    NASPath             string `gorm:"size:200" json:"nasPath"`
    DefaultCategory     string `gorm:"size:100;default:'AI生成'" json:"defaultCategory"`
}
```

## 配置结构

### GenerateParams 生成参数

```go
type GenerateParams struct {
    Model          string   `json:"model"`          // 3.1（默认）
    Prompt         *string  `json:"prompt"`
    ImageBase64    *string  `json:"imageBase64"`
    ImageURL       *string  `json:"imageUrl"`
    MultiViewImages []ViewImage `json:"multiViewImages"`
    EnablePBR      bool     `json:"enablePbr"`      // 默认true
    FaceCount      *int     `json:"faceCount"`
    GenerateType   string   `json:"generateType"`   // Normal（默认）
    ResultFormat   string   `json:"resultFormat"`   // GLB（默认）
}
```

### ViewImage 多视角图片

```go
type ViewImage struct {
    View        string `json:"view"`        // left/right/back/top/bottom/left_front/right_front
    ImageBase64 string `json:"imageBase64"`
}
```

### TaskResult 任务结果

```go
type TaskResult struct {
    Status       string     `json:"status"`
    ErrorCode    string     `json:"errorCode"`
    ErrorMessage string     `json:"errorMessage"`
    ResultFiles  []File3D   `json:"resultFiles"`
}

type File3D struct {
    Type            string `json:"type"`            // GLB
    URL             string `json:"url"`
    PreviewImageURL string `json:"previewImageUrl"`
}
```

### StorageInfo 存储信息

```go
type StorageInfo struct {
    LocalPath     string `json:"localPath"`     // 本地路径
    NASPath       string `json:"nasPath"`       // NAS路径
    ThumbnailPath string `json:"thumbnailPath"` // 预览图路径
    FileSize      int64  `json:"fileSize"`
    FileHash      string `json:"fileHash"`
    AccessURL     string `json:"accessUrl"`     // 访问URL
}
```

## 索引说明

- `job_id`：唯一索引，快速查询任务
- `status`：普通索引，按状态筛选
- `created_at`：时间索引，任务列表排序
- `file_hash`：普通索引，去重检查
