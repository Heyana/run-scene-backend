# 交互流程

## 完整流程

```
用户右键 → 输入需求
    ↓
前端导出节点元数据JSON
    ↓
POST /api/blueprint/generate
{
  "userRequest": "创建点击按钮播放动画",
  "metadata": {
    "UI/按钮": {...},
    "时间轴/播放": {...}
  }
}
    ↓
后端构建Prompt
    ↓
调用OpenAI/Claude API
    ↓
解析AI返回的JSON
    ↓
返回GraphJSON
{
  "nodes": [...],
  "links": [...]
}
    ↓
前端应用到画布
```

## 数据示例

### 请求

```json
{
  "userRequest": "创建一个点击按钮播放动画",
  "metadata": {
    "UI/按钮": {
      "type": "UI/按钮",
      "category": "UI",
      "inputs": [{ "name": "生成按钮", "type": "event" }],
      "outputs": [{ "name": "触发", "type": "event" }],
      "properties": [{ "key": "name", "label": "名称", "type": "text" }]
    },
    "时间轴/播放": {
      "type": "时间轴/播放",
      "category": "时间轴",
      "inputs": [{ "name": "执行", "type": "event" }],
      "outputs": [{ "name": "结束回调", "type": "event" }],
      "properties": [{ "key": "name", "label": "时间轴名称", "type": "text" }]
    }
  }
}
```

### 响应

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "graphJson": {
      "nodes": [
        {
          "id": 1,
          "type": "UI/按钮",
          "pos": [0, 0],
          "properties": { "name": "播放按钮" },
          "title": "播放按钮"
        },
        {
          "id": 2,
          "type": "时间轴/播放",
          "pos": [300, 0],
          "properties": { "name": "动画1" },
          "title": "播放动画"
        }
      ],
      "links": [[1, 1, 0, 2, 0, "event"]]
    }
  }
}
```

## 配置

### config.yaml

```yaml
ai:
  provider: "openai"
  api_key: "${OPENAI_API_KEY}"
  model: "gpt-4"
  temperature: 0.7
  max_tokens: 4000
```

### 环境变量

```bash
# Windows
$env:OPENAI_API_KEY="sk-xxx"

# Linux/Mac
export OPENAI_API_KEY="sk-xxx"
```

## 快速开始

### 1. 配置API Key

在 `config.yaml` 或环境变量中设置 `OPENAI_API_KEY`

### 2. 启动后端

```bash
cd run-scene-backend
go run main.go
```

### 3. 启动前端

```bash
cd 3d-编辑器-无协同-最新
yarn dev
```

### 4. 使用

1. 打开蓝图编辑器
2. 右键 → "AI 生成蓝图"
3. 输入需求："创建点击按钮播放动画"
4. 等待生成
5. 点击应用

## 完成
